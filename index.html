<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>遊んだ回数管理</title>
  <style>
    table {
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 12px;
      text-align: center;
    }
    button {
      margin: 0 4px;
    }
  </style>
</head>
<body>

<h2>遊んだ回数管理</h2>

<input id="nameInput" placeholder="名前">
<button id="addBtn">追加</button>

<table>
  <thead>
    <tr>
      <th>名前</th>
      <th>回数</th>
      <th>操作</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    doc,
    updateDoc,
    onSnapshot,
    increment
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCTri3rZLiory39Om1bjXcdVfTow7dXrfE",
    authDomain: "playcount-805bd.firebaseapp.com",
    projectId: "playcount-805bd",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const usersRef = collection(db, "users");

  // 名前追加
  document.getElementById("addBtn").onclick = async () => {
    const name = nameInput.value.trim();
    if (!name) return;

    await addDoc(usersRef, {
      name: name,
      point: 0
    });

    nameInput.value = "";
  };

  // ＋／−処理
  async function changePoint(id, diff) {
    const ref = doc(db, "users", id);
    await updateDoc(ref, {
      point: increment(diff)
    });
  }

  // リアルタイムでtable再描画
  onSnapshot(usersRef, (snapshot) => {
    tableBody.innerHTML = "";

    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      const tr = document.createElement("tr");

      const nameTd = document.createElement("td");
      nameTd.textContent = data.name;

      const pointTd = document.createElement("td");
      pointTd.textContent = data.point;

      const ctrlTd = document.createElement("td");

      const plusBtn = document.createElement("button");
      plusBtn.textContent = "+";
      plusBtn.onclick = () => changePoint(docSnap.id, +1);

      const minusBtn = document.createElement("button");
      minusBtn.textContent = "−";
      minusBtn.onclick = () => changePoint(docSnap.id, -1);

      ctrlTd.appendChild(plusBtn);
      ctrlTd.appendChild(minusBtn);

      tr.appendChild(nameTd);
      tr.appendChild(pointTd);
      tr.appendChild(ctrlTd);

      tableBody.appendChild(tr);
    });
  });
</script>

</body>
</html>
